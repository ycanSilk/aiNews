<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>语义化ID URL编码测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-case {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        .success {
            background-color: #e8f5e8;
            border: 1px solid #4caf50;
        }
        .info {
            background-color: #e3f2fd;
            border: 1px solid #2196f3;
        }
        h1 {
            color: #333;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>语义化ID URL编码测试 - 拼音转换解决方案</h1>
    <div id="testResults"></div>
    
    <div style="background: #fff3cd; padding: 15px; margin: 20px 0; border-radius: 8px; border: 1px solid #ffeaa7;">
      <h3>💡 解决方案说明</h3>
      <p><strong>问题1：中文编码长度</strong> - 中文URL编码后会变长，但这是Web标准要求，无法避免。</p>
      <p><strong>问题2：未定义关键词</strong> - 通过拼音转换解决，将中文转换为拼音缩短URL长度。</p>
      
      <h4>当前解决方案：</h4>
      <p>使用预设映射表处理热门公司/产品名称，未匹配时使用默认值</p>
      <ul>
        <li>公司映射表：百度→baidu、阿里/阿里巴巴→alibaba、哔哩哔哩→bilibili、华为→huawei、小米→xiaomi、深度求索→deepseek等</li>
        <li>产品映射表：文心一言→yiyan、ChatGPT→chatgpt、Gemini→gemini、Copilot→copilot等</li>
        <li>未匹配时默认值：公司→ai，产品→news</li>
        <li>URL格式：/news/公司-产品-YYYYMMDD001</li>
      </ul>
    </div>

    <script>


        // 公司名称映射表
         const companyMap = {
           '百度': 'baidu',
           '阿里': 'alibaba',
           '阿里巴巴': 'alibaba',
           '哔哩哔哩': 'bilibili',
           '华为': 'huawei',
           '小米': 'xiaomi',
           '深度求索': 'deepseek',
           '文心一言': 'yiyan',
           'openai': 'openai',
           'google': 'google',
           'microsoft': 'microsoft',
           'meta': 'meta',
           'tesla': 'tesla',
           'deepseek': 'deepseek'
         };

         // 产品名称映射表
         const productMap = {
           '文心一言': 'yiyan',
           'chatgpt': 'chatgpt',
           'gemini': 'gemini',
           'copilot': 'copilot',
           'llama': 'llama',
           'optimus': 'optimus',
           '昇腾': 'ascend',
           '芯片': 'chip'
         };

         // 简化的语义化ID生成函数（包含映射表功能）
        function generateSemanticId(title, date, sequence = 1, customCompany, customProduct) {
            const companyPatterns = [
                'openai', 'chatgpt', 'google', 'gemini', 'microsoft', 'copilot', 'meta', 'llama',
                'tesla', 'nvidia', 'amd', 'intel', 'apple', 'amazon', 'aws', 'anthropic', 'claude',
                'baidu', 'ernie', 'alibaba', 'tencent', 'huawei', 'samsung', 'ibm', 'oracle',
                'tsinghua', 'thudm', '清华大学', '华为', '百度', '阿里巴巴', '腾讯'
            ];

            const productPatterns = [
                'gpt', 'dall-e', 'midjourney', 'stable diffusion', 'bard', 'palm', 'bert',
                'tensorflow', 'pytorch', 'keras', 'transformers', 'huggingface', 'langchain',
                'autogpt', 'agentgpt', 'babyagi', 'pinecone', 'weaviate', 'chroma',
                'llama', 'mistral', 'falcon', 'bloom', 'opt', 't5', 'blenderbot',
                'claude', 'anthropic', 'cohere', 'ai21', 'stability', 'runway',
                'replicate', 'together', 'banana', 'modal', 'beam', 'vast', 'lambda',
                'cerebras', 'graphcore', 'sambanova', 'groq', 'mythic', 'tenstorrent'
            ];

            const lowerTitle = title.toLowerCase();
            
            let company = customCompany || '';
            if (!company) {
                // 首先检查映射表中的公司名称
                for (const [chineseName, englishName] of Object.entries(companyMap)) {
                    if (lowerTitle.includes(chineseName.toLowerCase()) || lowerTitle.includes(englishName)) {
                        company = englishName;
                        break;
                    }
                }
                
                // 如果没有匹配的映射，检查其他常见模式
                if (!company) {
                    for (const pattern of companyPatterns) {
                        if (lowerTitle.includes(pattern.toLowerCase())) {
                            company = pattern.toLowerCase();
                            break;
                        }
                    }
                }
            }

            // 查找产品名称（优先使用自定义的产品名）
            let product = customProduct || '';
            if (!product) {
                // 首先检查映射表中的产品名称（但排除已经在公司映射表中匹配到的名称）
                 for (const [chineseName, englishName] of Object.entries(productMap)) {
                     if ((lowerTitle.includes(chineseName.toLowerCase()) || lowerTitle.includes(englishName)) && 
                         !company.includes(englishName)) { // 避免与公司名重复
                         product = englishName;
                         break;
                     }
                 }
                
                // 如果没有匹配的映射，检查其他常见模式
                if (!product) {
                     for (const pattern of productPatterns) {
                         if (lowerTitle.includes(pattern.toLowerCase()) && !company.includes(pattern)) {
                             product = pattern.toLowerCase();
                             break;
                         }
                     }
                 }
            }

            if (!company) company = 'ai';
            if (!product) {
                const words = title.toLowerCase().split(/\s+/);
                const mainWords = words.filter(word => 
                    word.length > 3 && 
                    !['the', 'and', 'or', 'in', 'on', 'at', 'to', 'for', 'with', 'by'].includes(word)
                );
                product = mainWords.slice(0, 2).join('-') || 'news';
            }

            company = company.replace(/[^a-z0-9]/g, '');
            product = product.replace(/[^a-z0-9]/g, '');
            
            // 如果公司或产品名包含非英文字符，使用默认值
            if (!/^[a-zA-Z0-9-]+$/.test(company)) {
                company = 'ai';
            }
            if (!/^[a-zA-Z0-9-]+$/.test(product)) {
                product = 'news';
            }
            const formattedDate = date.replace(/-/g, '');
            const formattedSequence = sequence.toString().padStart(3, '0');

            const rawId = `${company}-${product}-${formattedDate}${formattedSequence}`;
            return encodeURIComponent(rawId);
        }

        // 测试用例
        const testCases = [
            { title: "OpenAI releases GPT-5 preview with multimodal capabilities", date: "2025-08-27" },
            { title: "Microsoft announces new Copilot features for Windows 12", date: "2025-08-26" },
            { title: "Google unveils Gemini 2.0 with enhanced reasoning skills", date: "2025-08-25" },
            { title: "Tesla demonstrates fully autonomous driving in urban environments", date: "2025-08-24" },
            { title: "Meta launches Llama 3 with 1 trillion parameters", date: "2025-08-23" },
            { title: "华为发布新一代昇腾AI芯片，性能提升200%", date: "2025-08-22" },
            { title: "百度文心一言4.0正式发布，支持多模态生成", date: "2025-08-21" },
            // 测试未定义关键词的案例
            { title: "深度求索发布新一代AI搜索引擎", date: "2025-08-28", customCompany: "deepseek", customProduct: "ai-search" },
            { title: "字节跳动推出多模态大模型", date: "2025-08-28", customCompany: "bytedance", customProduct: "multimodal-ai" },
            // 添加映射表中公司名称的测试案例
            { title: "哔哩哔哩推出AI视频生成工具", date: "2025-08-29" },
            { title: "文心一言对话体验优化", date: "2025-08-30" },
            { title: "DeepSeek代码助手发布", date: "2025-08-31" }
        ];

        const resultsDiv = document.getElementById('testResults');
        
        testCases.forEach((testCase, index) => {
            const encodedId = generateSemanticId(
                testCase.title, 
                testCase.date,
                1,
                testCase.customCompany,
                testCase.customProduct
            );
            const rawId = decodeURIComponent(encodedId);
            
            const testDiv = document.createElement('div');
            testDiv.className = 'test-case';
            
            let customInfo = '';
            if (testCase.customCompany || testCase.customProduct) {
                customInfo = `<div class="result success"><strong>自定义映射:</strong> company=${testCase.customCompany || '默认'}, product=${testCase.customProduct || '默认'}</div>`;
            }
            

            
            testDiv.innerHTML = `
                <h3>测试 ${index + 1}</h3>
                <div><strong>标题:</strong> ${testCase.title}</div>
                <div><strong>日期:</strong> ${testCase.date}</div>
                ${customInfo}

                <div class="result info"><strong>原始ID:</strong> ${rawId}</div>
                <div class="result success"><strong>URL编码ID:</strong> ${encodedId}</div>
                <div class="result success"><strong>URL长度:</strong> ${encodedId.length} 字符</div>
                <div class="result success"><strong>示例URL:</strong> /news/${encodedId}</div>
                <div class="result info"><strong>URL解码验证:</strong> ${decodeURIComponent(encodedId)}</div>
                <div class="result success"><strong>优化效果:</strong> 通过映射表将中文名称转换为英文标识符，简化URL，确保URL安全性</div>
            `;
            
            resultsDiv.appendChild(testDiv);
        });
    </script>
</body>
</html>